# ðŸš€ Ð‘Ñ‹ÑÑ‚Ñ€Ñ‹Ð¹ Ð´ÐµÐ¿Ð»Ð¾Ð¹ Ð½Ð° ÑÐµÑ€Ð²ÐµÑ€

## ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð´ÐµÐ¿Ð»Ð¾Ð¹ (Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÑ‚ÑÑ)

```bash
# Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ ÑÐºÑ€Ð¸Ð¿Ñ‚ Ð´ÐµÐ¿Ð»Ð¾Ñ
./deploy.sh
```

Ð¡ÐºÑ€Ð¸Ð¿Ñ‚ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸:
- âœ… ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ SSH Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ
- âœ… Ð¡Ð¾Ð·Ð´Ð°ÑÑ‚ Ñ€ÐµÐ·ÐµÑ€Ð²Ð½ÑƒÑŽ ÐºÐ¾Ð¿Ð¸ÑŽ
- âœ… ÐžÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ ÑÑ‚Ð°Ñ€Ñ‹Ð¹ Ð¿Ñ€Ð¾Ñ†ÐµÑÑ
- âœ… Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ ÐºÐ¾Ð´ Ð½Ð° ÑÐµÑ€Ð²ÐµÑ€
- âœ… Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸
- âœ… Ð¡Ð¾Ð±ÐµÑ€ÐµÑ‚ Ð¿Ñ€Ð¾ÐµÐºÑ‚
- âœ… Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ Ñ‡ÐµÑ€ÐµÐ· PM2

---

## Ð ÑƒÑ‡Ð½Ð¾Ð¹ Ð´ÐµÐ¿Ð»Ð¾Ð¹

### 1. ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒÑÑ Ðº ÑÐµÑ€Ð²ÐµÑ€Ñƒ

```bash
ssh root@46.224.27.19
```

### 2. ÐŸÐµÑ€ÐµÐ¹Ñ‚Ð¸ Ð² Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸ÑŽ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°

```bash
cd /var/www/wl
```

### 3. Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ñ€ÐµÐ·ÐµÑ€Ð²Ð½ÑƒÑŽ ÐºÐ¾Ð¿Ð¸ÑŽ

```bash
cp -r /var/www/wl /var/www/wl.backup-$(date +%Y%m%d-%H%M%S)
```

### 4. ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ ÐºÐ¾Ð´

```bash
# Ð•ÑÐ»Ð¸ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ Git
git pull origin main

# Ð˜Ð»Ð¸ ÑÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ñ„Ð°Ð¹Ð»Ñ‹ Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ
```

### 5. ÐžÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ ÑÑ‚Ð°Ñ€Ñ‹Ð¹ Ð¿Ñ€Ð¾Ñ†ÐµÑÑ

```bash
pm2 stop wl-shop || true
pm2 delete wl-shop || true
```

### 6. Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸

```bash
npm install --production
```

### 7. Ð¡Ð³ÐµÐ½ÐµÑ€Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Prisma ÐºÐ»Ð¸ÐµÐ½Ñ‚

```bash
npx prisma generate
```

### 8. ÐžÑ‡Ð¸ÑÑ‚Ð¸Ñ‚ÑŒ ÐºÑÑˆ Ð¸ ÑÐ¾Ð±Ñ€Ð°Ñ‚ÑŒ

```bash
rm -rf .next
npm run build
```

### 9. Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ/Ð¾Ð±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ .env Ñ„Ð°Ð¹Ð»

```bash
nano .env
```

**ÐœÐ¸Ð½Ð¸Ð¼Ð°Ð»ÑŒÐ½Ñ‹Ð¹ .env:**
```env
NODE_ENV=production
PORT=3000
NEXTAUTH_URL=http://46.224.27.19:3000
NEXTAUTH_SECRET=Ð²Ð°Ñˆ-ÑÐµÐºÑ€ÐµÑ‚Ð½Ñ‹Ð¹-ÐºÐ»ÑŽÑ‡-Ð¼Ð¸Ð½Ð¸Ð¼ÑƒÐ¼-32-ÑÐ¸Ð¼Ð²Ð¾Ð»Ð°
DATABASE_URL=postgresql://postgres:password@localhost:5432/wl_shop?schema=public
NEXT_PUBLIC_API_URL=http://46.224.27.19:3000/api
NEXT_PUBLIC_SITE_URL=http://46.224.27.19:3000
```

**âš ï¸ Ð’ÐÐ–ÐÐž:** 
- Ð¡Ð³ÐµÐ½ÐµÑ€Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ `NEXTAUTH_SECRET`: `openssl rand -base64 32`
- ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚Ðµ `DATABASE_URL` Ñ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ‹Ð¼Ð¸ Ð´Ð°Ð½Ð½Ñ‹Ð¼Ð¸ Ð‘Ð”

### 10. Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ PM2 ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸ÑŽ

```bash
cat > ecosystem.config.js << 'EOF'
module.exports = {
  apps: [{
    name: 'wl-shop',
    script: 'npm',
    args: 'start',
    cwd: '/var/www/wl',
    env: {
      NODE_ENV: 'production',
      PORT: 3000
    },
    error_file: './logs/err.log',
    out_file: './logs/out.log',
    autorestart: true,
    max_memory_restart: '1G'
  }]
};
EOF
```

### 11. Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ Ñ‡ÐµÑ€ÐµÐ· PM2

```bash
pm2 start ecosystem.config.js
pm2 save
pm2 startup  # ÐÐ²Ñ‚Ð¾Ð·Ð°Ð¿ÑƒÑÐº Ð¿Ñ€Ð¸ Ð¿ÐµÑ€ÐµÐ·Ð°Ð³Ñ€ÑƒÐ·ÐºÐµ ÑÐµÑ€Ð²ÐµÑ€Ð°
```

### 12. ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ ÑÑ‚Ð°Ñ‚ÑƒÑ

```bash
# Ð¡Ñ‚Ð°Ñ‚ÑƒÑ
pm2 status

# Ð›Ð¾Ð³Ð¸
pm2 logs wl-shop

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾ÑÑ‚Ð¸
curl -I http://localhost:3000
```

---

## ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¿Ð¾ÑÐ»Ðµ Ð´ÐµÐ¿Ð»Ð¾Ñ

### âœ… Ð§ÐµÐºÐ»Ð¸ÑÑ‚

- [ ] PM2 Ð¿Ñ€Ð¾Ñ†ÐµÑÑ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½: `pm2 status`
- [ ] ÐŸÑ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð¾Ñ‚Ð²ÐµÑ‡Ð°ÐµÑ‚: `curl http://localhost:3000`
- [ ] ÐÐµÑ‚ Ð¾ÑˆÐ¸Ð±Ð¾Ðº Ð² Ð»Ð¾Ð³Ð°Ñ…: `pm2 logs wl-shop --lines 50`
- [ ] Ð‘Ð°Ð·Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð° (Ð¿Ñ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ð² Ð»Ð¾Ð³Ð°Ñ…)
- [ ] Ð¡Ð°Ð¹Ñ‚ Ð´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½: `http://46.224.27.19:3000`

---

## Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ PM2

```bash
# Ð¡Ñ‚Ð°Ñ‚ÑƒÑ
pm2 status

# Ð›Ð¾Ð³Ð¸
pm2 logs wl-shop

# ÐŸÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÐº
pm2 restart wl-shop

# ÐžÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ°
pm2 stop wl-shop

# Ð£Ð´Ð°Ð»ÐµÐ½Ð¸Ðµ
pm2 delete wl-shop

# ÐœÐ¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³
pm2 monit
```

---

## ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°

ÐšÐ¾Ð³Ð´Ð° Ð½ÑƒÐ¶Ð½Ð¾ Ð¾Ð±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ ÐºÐ¾Ð´:

```bash
# Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚ 1: ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸
./deploy.sh

# Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚ 2: Ð’Ñ€ÑƒÑ‡Ð½ÑƒÑŽ
ssh root@46.224.27.19
cd /var/www/wl
git pull origin main
npm install --production
rm -rf .next
npm run build
pm2 restart wl-shop
```

---

## Ð£ÑÑ‚Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼

### ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð°: "ÐŸÐ¾Ñ€Ñ‚ 3000 Ð·Ð°Ð½ÑÑ‚"

```bash
# ÐÐ°Ð¹Ñ‚Ð¸ Ð¿Ñ€Ð¾Ñ†ÐµÑÑ
netstat -tlnp | grep :3000

# ÐžÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ PM2
pm2 stop wl-shop
```

### ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð°: "ÐŸÑ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð½Ðµ Ð·Ð°Ð¿ÑƒÑÐºÐ°ÐµÑ‚ÑÑ"

```bash
# ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ð»Ð¾Ð³Ð¸
pm2 logs wl-shop --lines 100

# ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ .env
cat .env

# ÐŸÐµÑ€ÐµÑÐ¾Ð±Ñ€Ð°Ñ‚ÑŒ
rm -rf .next node_modules
npm install
npm run build
pm2 restart wl-shop
```

### ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð°: "Ð‘Ð°Ð·Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð½Ðµ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡Ð°ÐµÑ‚ÑÑ"

```bash
# ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ DATABASE_URL
cat .env | grep DATABASE_URL

# ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ
npx prisma db pull
```

---

## Ð‘ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚ÑŒ

**âš ï¸ ÐšÐ Ð˜Ð¢Ð˜Ð§ÐÐž:**

1. **NEXTAUTH_SECRET** Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð±Ñ‹Ñ‚ÑŒ ÑƒÐ½Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¼ Ð¸ Ð´Ð»Ð¸Ð½Ð½Ñ‹Ð¼ (Ð¼Ð¸Ð½Ð¸Ð¼ÑƒÐ¼ 32 ÑÐ¸Ð¼Ð²Ð¾Ð»Ð°)
   ```bash
   openssl rand -base64 32
   ```

2. **DATABASE_URL** Ð½Ðµ Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð±Ñ‹Ñ‚ÑŒ Ð² Git
   - ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ `.gitignore` ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ñ‚ `.env`

3. **ÐŸÐ°Ñ€Ð¾Ð»Ð¸ Ð‘Ð”** Ð´Ð¾Ð»Ð¶Ð½Ñ‹ Ð±Ñ‹Ñ‚ÑŒ ÑÐ¸Ð»ÑŒÐ½Ñ‹Ð¼Ð¸

4. **HTTPS** Ð² Ð¿Ñ€Ð¾Ð´Ð°ÐºÑˆÐµÐ½Ðµ (Ñ‡ÐµÑ€ÐµÐ· Nginx + Let's Encrypt)

---

## Ð”Ð¾ÑÑ‚ÑƒÐ¿ Ðº Ð¿Ñ€Ð¾ÐµÐºÑ‚Ñƒ

ÐŸÐ¾ÑÐ»Ðµ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾Ð³Ð¾ Ð´ÐµÐ¿Ð»Ð¾Ñ:

- **ÐŸÑ€ÑÐ¼Ð¾Ð¹ Ð´Ð¾ÑÑ‚ÑƒÐ¿:** `http://46.224.27.19:3000`
- **Ð§ÐµÑ€ÐµÐ· Ð´Ð¾Ð¼ÐµÐ½:** (ÐµÑÐ»Ð¸ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½ Nginx) `http://Ð²Ð°Ñˆ-Ð´Ð¾Ð¼ÐµÐ½.com`

---

**Ð“Ð¾Ñ‚Ð¾Ð²Ð¾!** ðŸŽ‰


